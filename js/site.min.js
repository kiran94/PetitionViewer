function init(a){loader=document.getElementById("loader"),dataDictionary=new Array;for(var b=0;b<headerArray.length;b++)dataDictionary[headerArray[b]]=document.getElementById(headerArray[b]);registerURLButton(),setFooterDate(),a()}function GetData(a,b,c){$.ajax({url:a,data:b,type:"GET",dataType:"json",success:c,error:function(a){console.log("err")}})}function ApplyPetitionToDOM(a,b,c){if(loader.style.display="none","success"==b){setPageHeaders(a),setPetitionState();var d=dataDictionary.signature_count.innerHTML;dataDictionary.signature_count.innerHTML=numberWithCommas(d)+" Signatures",dataDictionary.created_at.innerHTML=dataDictionary.created_at.innerHTML.replace("T"," ").replace("Z"," "),GenerateWithoutUKChart("signaturesByCountry",a.data.attributes.signatures_by_country),GenerateWithUKChart("signaturesByCountryWithUK",a.data.attributes.signatures_by_country);var e=sort(a.data.attributes.signatures_by_country,function(a,b){return a.signature_count>b.signature_count?-1:a.signature_count==b.signature_count?0:1});setLargestSignatureCounts(e)}else console.warn("ajax call was successful however status was not successful")}function setPageHeaders(a){for(var b=0;b<headerArray.length;b++){var c=dataDictionary[headerArray[b]];null!=c&&(c.innerHTML=a.data.attributes[headerArray[b]])}}function setPetitionState(){var a=dataDictionary.state;a.innerHTML=a.innerHTML.toUpperCase(),"OPEN"==a.innerHTML?a.className=" openState":a.className=" closedState"}function GenerateWithoutUKChart(a,b){for(var c=[],d=[],e=[],f=0;f<b.length;f++)"United Kingdom"!=b[f].name&&(c.push(b[f].name),d.push(b[f].signature_count),e.push("rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")"));GenerateChart(a,c,d,e,"Signatures without UK")}function GenerateWithUKChart(a,b){for(var c=[],d=[],e=[],f=0;f<b.length;f++)c.push(b[f].name),d.push(b[f].signature_count),e.push("rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")");GenerateChart(a,c,d,e,"Signatures with UK")}function GenerateChart(a,b,c,d,e){var f=document.getElementById(a);new Chart(f,{type:"pie",data:{labels:b,datasets:[{label:"# of Signatures",data:c,backgroundColor:d,borderColor:d,borderWidth:1}]},options:{legend:{display:!1},title:{text:e,display:!0},maintainAspectRatio:!1,responsive:!0}})}function sort(a,b){return a.sort(b)}function setLargestSignatureCounts(a){var b=document.getElementById("signatureList");b.innerHTML="";for(var c=0;c<a.length&&c<limit;c++){var d=document.createElement("li"),e=document.createTextNode(a[c].name+" ("+numberWithCommas(a[c].signature_count)+")");d.appendChild(e),b.appendChild(d)}}function registerURLButton(){var a=document.getElementById("currentURLButton");a.addEventListener("click",function(){var a=document.getElementById("currentURL").value;a&&GetData(a,null,ApplyPetitionToDOM)})}function setFooterDate(){var a=document.getElementById("date");a.innerHTML=(new Date).getFullYear()}function numberWithCommas(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}var loader,headerArray=["action","background","state","signature_count","created_at","government_response_at","creator_name","government_response"],dataDictionary,limit=10,defaultPetitionURL="https://petition.parliament.uk/petitions/131215.json";$(document).ready(function(){document.getElementById("currentURL").value=defaultPetitionURL,init(function(){GetData(defaultPetitionURL,null,ApplyPetitionToDOM)})});